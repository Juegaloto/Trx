<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Inversión TRX</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d62c9;
            --secondary: #34a853;
            --secondary-dark: #2d9246;
            --danger: #ea4335;
            --danger-dark: #d33426;
            --warning: #fbbc05;
            --dark: #202124;
            --light: #f8f9fa;
            --gray: #5f6368;
            --gray-light: #f0f0f0;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
            font-size: 14px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
        }
        
        /* Header y Navegación */
        header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .logo i {
            margin-right: 8px;
            font-size: 1.5rem;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
        }
        
        .nav-links li {
            margin-left: 20px;
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            font-size: 0.9rem;
            padding: 6px 0;
            position: relative;
        }
        
        .nav-links a:hover {
            color: var(--primary);
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: var(--transition);
        }
        
        .nav-links a:hover::after {
            width: 100%;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
        }
        
        .user-info {
            margin-right: 12px;
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), #6c5ce7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-size: 0.9rem;
        }
        
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(26, 115, 232, 0.3);
        }
        
        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: var(--secondary-dark);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: var(--danger-dark);
            transform: translateY(-2px);
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }
        
        /* Menú lateral */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100vh;
            background-color: white;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
            transition: left 0.3s ease;
            z-index: 200;
            padding: 20px;
            overflow-y: auto;
        }
        
        .sidebar.active {
            left: 0;
        }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .sidebar-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .close-sidebar {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--gray);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .close-sidebar:hover {
            background-color: var(--gray-light);
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 8px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 14px;
            text-decoration: none;
            color: var(--dark);
            border-radius: var(--border-radius);
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .sidebar-menu a:hover {
            background-color: var(--gray-light);
            transform: translateX(4px);
        }
        
        .sidebar-menu i {
            margin-right: 10px;
            width: 18px;
            text-align: center;
            font-size: 1rem;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 150;
            display: none;
            backdrop-filter: blur(4px);
        }
        
        .overlay.active {
            display: block;
        }
        
        /* Contenido principal */
        .main-content {
            padding: 24px 0;
            min-height: calc(100vh - 80px);
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 18px;
            margin-bottom: 28px;
        }
        
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.03);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }
        
        .card-title {
            font-size: 0.9rem;
            color: var(--gray);
            font-weight: 500;
        }
        
        .card-icon {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
        }
        
        .card-icon.primary {
            background: linear-gradient(135deg, var(--primary), #4285f4);
        }
        
        .card-icon.secondary {
            background: linear-gradient(135deg, var(--secondary), #34a853);
        }
        
        .card-icon.warning {
            background: linear-gradient(135deg, var(--warning), #f9ab00);
        }
        
        .card-icon.danger {
            background: linear-gradient(135deg, var(--danger), #d93025);
        }
        
        .card-value {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 6px;
            color: var(--dark);
        }
        
        .card-description {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 22px;
            margin-bottom: 28px;
            border: 1px solid rgba(0, 0, 0, 0.03);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 14px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark);
        }
        
        /* Formularios */
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            transition: var(--transition);
            background-color: #fafafa;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            background-color: white;
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }
        
        .form-text {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 6px;
        }
        
        /* Tablas */
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th, .table td {
            padding: 12px 14px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
            font-size: 0.85rem;
        }
        
        .table th {
            font-weight: 600;
            color: var(--gray);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .table tbody tr:hover {
            background-color: #f9f9f9;
        }
        
        .status {
            display: inline-flex;
            align-items: center;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            gap: 4px;
        }
        
        .status.active {
            background-color: #e6f4ea;
            color: var(--secondary);
        }
        
        .status.pending {
            background-color: #fef7e0;
            color: var(--warning);
        }
        
        .status.completed {
            background-color: #e6f4ea;
            color: var(--secondary);
        }
        
        .status.cancelled {
            background-color: #fce8e6;
            color: var(--danger);
        }
        
        /* Modales */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 300;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            backdrop-filter: blur(4px);
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            padding: 24px;
            transform: translateY(-20px);
            transition: transform 0.3s;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 14px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .modal-title {
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--gray);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            background-color: var(--gray-light);
        }
        
        /* Páginas de autenticación */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary), #6c5ce7);
            padding: 20px;
        }
        
        .auth-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            width: 90%;
            max-width: 420px;
            padding: 28px;
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 28px;
        }
        
        .auth-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .auth-subtitle {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .auth-footer {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .auth-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .auth-link:hover {
            text-decoration: underline;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .table-responsive {
                overflow-x: auto;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .section-title {
                font-size: 1.1rem;
            }
            
            .card-value {
                font-size: 1.4rem;
            }
            
            .modal-content {
                width: 95%;
                padding: 18px;
            }
            
            .investment-details {
                grid-template-columns: 1fr;
            }
            
            .investment-actions {
                flex-direction: column;
            }
            
            .transaction-filters {
                flex-wrap: wrap;
                gap: 8px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 12px;
            }
            
            .main-content {
                padding: 16px 0;
            }
            
            .section {
                padding: 18px;
            }
            
            .auth-card {
                padding: 22px;
            }
            
            .btn {
                padding: 8px 14px;
                font-size: 0.85rem;
            }
            
            .card {
                padding: 16px;
            }
        }
        
        /* Utilidades */
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .mb-3 {
            margin-bottom: 16px;
        }
        
        .mt-3 {
            margin-top: 16px;
        }
        
        .d-none {
            display: none !important;
        }
        
        .d-block {
            display: block;
        }
        
        .d-flex {
            display: flex;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .align-center {
            align-items: center;
        }
        
        .w-100 {
            width: 100%;
        }
        
        .alert {
            padding: 12px 14px;
            border-radius: var(--border-radius);
            margin-bottom: 18px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 0.9rem;
        }
        
        .alert-success {
            background-color: #e6f4ea;
            color: var(--secondary);
            border: 1px solid #c4e6d4;
        }
        
        .alert-danger {
            background-color: #fce8e6;
            color: var(--danger);
            border: 1px solid #f5c2c7;
        }
        
        .alert-warning {
            background-color: #fef7e0;
            color: var(--warning);
            border: 1px solid #fae8b3;
        }
        
        .referral-code {
            background-color: var(--gray-light);
            padding: 12px 14px;
            border-radius: var(--border-radius);
            font-family: monospace;
            font-size: 0.95rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .copy-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
        }
        
        .copy-btn:hover {
            background-color: rgba(26, 115, 232, 0.1);
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .badge-primary {
            background-color: rgba(26, 115, 232, 0.1);
            color: var(--primary);
        }
        
        .badge-secondary {
            background-color: rgba(52, 168, 83, 0.1);
            color: var(--secondary);
        }
        
        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
        
        /* Scroll personalizado */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* Estilos para inversiones activas modernas */
        .investment-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(0, 0, 0, 0.03);
            transition: var(--transition);
        }
        
        .investment-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .investment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .investment-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--dark);
        }
        
        .investment-plan {
            display: inline-flex;
            align-items: center;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            background-color: rgba(26, 115, 232, 0.1);
            color: var(--primary);
        }
        
        .investment-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .investment-detail {
            text-align: center;
        }
        
        .investment-detail-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .investment-detail-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .progress-container {
            margin-bottom: 20px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .progress-label {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .progress-percentage {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--primary);
        }
        
        .progress-bar {
            height: 8px;
            background-color: var(--gray-light);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), #6c5ce7);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .investment-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.8rem;
        }
        
        .btn-disabled {
            background-color: var(--gray-light);
            color: var(--gray);
            cursor: not-allowed;
        }
        
        .btn-disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        /* Estilos para el botón de nueva inversión */
        .new-investment-btn {
            background: linear-gradient(135deg, var(--primary), #6c5ce7);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
        }
        
        .new-investment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(26, 115, 232, 0.4);
        }
        
        /* Estilos para el modal de detalles de inversión */
        .investment-detail-modal .modal-content {
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .investment-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-item {
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
        }
        
        .info-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        /* Estilos para las transacciones en el historial */
        .transaction-positive {
            color: var(--secondary);
            font-weight: 600;
        }
        
        .transaction-negative {
            color: var(--danger);
            font-weight: 600;
        }
        
        .transaction-type {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .transaction-type.deposit {
            background-color: rgba(52, 168, 83, 0.1);
            color: var(--secondary);
        }
        
        .transaction-type.withdrawal {
            background-color: rgba(234, 67, 53, 0.1);
            color: var(--danger);
        }
        
        .transaction-type.investment {
            background-color: rgba(26, 115, 232, 0.1);
            color: var(--primary);
        }
        
        .transaction-type.earning {
            background-color: rgba(251, 188, 5, 0.1);
            color: var(--warning);
        }
        
        /* Filtros de transacciones */
        .transaction-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        /* Sistema de notificaciones moderno */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }
        
        .notification {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 16px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            border-left: 4px solid var(--primary);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.hide {
            transform: translateX(400px);
        }
        
        .notification.success {
            border-left-color: var(--secondary);
        }
        
        .notification.error {
            border-left-color: var(--danger);
        }
        
        .notification.warning {
            border-left-color: var(--warning);
        }
        
        .notification-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            flex-shrink: 0;
        }
        
        .notification.success .notification-icon {
            background-color: var(--secondary);
        }
        
        .notification.error .notification-icon {
            background-color: var(--danger);
        }
        
        .notification.warning .notification-icon {
            background-color: var(--warning);
        }
        
        .notification.info .notification-icon {
            background-color: var(--primary);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 0.9rem;
        }
        
        .notification-message {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .notification-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
            flex-shrink: 0;
        }
        
        .notification-close:hover {
            background-color: var(--gray-light);
        }
        
        /* Diálogos de confirmación */
        .confirmation-dialog .modal-content {
            max-width: 400px;
            text-align: center;
        }
        
        .confirmation-icon {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            font-size: 1.5rem;
            color: white;
        }
        
        .confirmation-icon.warning {
            background-color: var(--warning);
        }
        
        .confirmation-icon.danger {
            background-color: var(--danger);
        }
        
        .confirmation-icon.success {
            background-color: var(--secondary);
        }
        
        .confirmation-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .confirmation-actions .btn {
            flex: 1;
        }
        
        /* Gap utility */
        .gap-2 {
            gap: 8px;
        }
    </style>
</head>
<body>
    <!-- Sistema de Notificaciones -->
    <div class="notification-container" id="notificationContainer"></div>
    
    <!-- Overlay para el menú lateral -->
    <div class="overlay" id="overlay"></div>
    
    <!-- Menú lateral -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">Menú Principal</div>
            <button class="close-sidebar" id="closeSidebar">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#" data-page="dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="#" data-page="invest"><i class="fas fa-chart-line"></i> Invertir</a></li>
            <li><a href="#" data-page="deposit"><i class="fas fa-wallet"></i> Depositar</a></li>
            <li><a href="#" data-page="withdraw"><i class="fas fa-money-bill-wave"></i> Retirar</a></li>
            <li><a href="#" data-page="referrals"><i class="fas fa-users"></i> Referidos</a></li>
            <li><a href="#" data-page="history"><i class="fas fa-history"></i> Historial</a></li>
            <li><a href="#" data-page="profile"><i class="fas fa-user"></i> Perfil</a></li>
            <li><a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a></li>
        </ul>
    </div>
    
    <!-- Header -->
    <header>
        <div class="container">
            <div class="navbar">
                <div class="logo">
                    <i class="fas fa-coins"></i>
                    <span>TRX Investment</span>
                </div>
                <ul class="nav-links">
                    <li><a href="#" data-page="dashboard">Dashboard</a></li>
                    <li><a href="#" data-page="invest">Invertir</a></li>
                    <li><a href="#" data-page="deposit">Depositar</a></li>
                    <li><a href="#" data-page="withdraw">Retirar</a></li>
                    <li><a href="#" data-page="referrals">Referidos</a></li>
                </ul>
                <div class="user-menu">
                    <div class="user-info" id="userInfo">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <span id="userName">Usuario</span>
                    </div>
                    <button class="btn btn-primary" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Contenido principal -->
    <div class="main-content">
        <div class="container">
            <!-- Página de Dashboard -->
            <div id="dashboard-page" class="page fade-in">
                <h1 class="mb-3">Dashboard</h1>
                
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Balance Total</div>
                            <div class="card-icon primary">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                        <div class="card-value" id="totalBalance">0 TRX</div>
                        <div class="card-description">Saldo disponible + inversiones activas</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Ganancias Totales</div>
                            <div class="card-icon secondary">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="card-value" id="totalEarnings">0 TRX</div>
                        <div class="card-description">Ganancias acumuladas</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Inversiones Activas</div>
                            <div class="card-icon warning">
                                <i class="fas fa-cube"></i>
                            </div>
                        </div>
                        <div class="card-value" id="activeInvestments">0</div>
                        <div class="card-description">Máquinas mineras activas</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Referidos</div>
                            <div class="card-icon danger">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="card-value" id="totalReferrals">0</div>
                        <div class="card-description">Usuarios referidos</div>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">Inversiones Activas</div>
                        <button class="new-investment-btn" data-page="invest">
                            <i class="fas fa-plus"></i> Nueva Inversión
                        </button>
                    </div>
                    <div id="activeInvestmentsContainer">
                        <!-- Aquí se cargarán las inversiones activas con diseño moderno -->
                        <div class="text-center" id="investmentsLoading">
                            <p>Cargando inversiones...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Página de Inversión -->
            <div id="invest-page" class="page d-none">
                <h1 class="mb-3">Realizar Inversión</h1>
                
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">Planes de Inversión</div>
                    </div>
                    
                    <div class="alert alert-warning">
                        <i class="fas fa-info-circle"></i> Todos los planes pagan un 3% diario durante 15 días (45% de retorno total).
                    </div>
                    
                    <div class="dashboard-cards">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Plan Básico</div>
                                <div class="card-icon primary">
                                    <i class="fas fa-cube"></i>
                                </div>
                            </div>
                            <div class="card-value">30 - 100 TRX</div>
                            <div class="card-description">3% diario por 15 días</div>
                            <button class="btn btn-primary mt-3" data-plan="basic">
                                <i class="fas fa-check"></i> Seleccionar
                            </button>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Plan Avanzado</div>
                                <div class="card-icon secondary">
                                    <i class="fas fa-cubes"></i>
                                </div>
                            </div>
                            <div class="card-value">101 - 300 TRX</div>
                            <div class="card-description">3% diario por 15 días</div>
                            <button class="btn btn-primary mt-3" data-plan="advanced">
                                <i class="fas fa-check"></i> Seleccionar
                            </button>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Plan Premium</div>
                                <div class="card-icon warning">
                                    <i class="fas fa-gem"></i>
                                </div>
                            </div>
                            <div class="card-value">301 - 500 TRX</div>
                            <div class="card-description">3% diario por 15 días</div>
                            <button class="btn btn-primary mt-3" data-plan="premium">
                                <i class="fas fa-check"></i> Seleccionar
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="section d-none" id="investmentForm">
                    <div class="section-header">
                        <div class="section-title">Confirmar Inversión</div>
                    </div>
                    
                    <form id="investForm">
                        <div class="form-group">
                            <label class="form-label">Plan seleccionado</label>
                            <input type="text" class="form-control" id="selectedPlan" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Monto a invertir (TRX)</label>
                            <input type="number" class="form-control" id="investmentAmount" min="30" max="500" required>
                            <div class="form-text">El monto debe estar entre 30 y 500 TRX según el plan seleccionado.</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Ganancia esperada</label>
                            <input type="text" class="form-control" id="expectedEarnings" readonly>
                            <div class="form-text">3% diario durante 15 días (45% de retorno total).</div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-check-circle"></i> Confirmar Inversión
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Página de Depósito -->
            <div id="deposit-page" class="page d-none">
                <h1 class="mb-3">Realizar Depósito</h1>
                
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">Información de Depósito</div>
                    </div>
                    
                    <div class="alert alert-warning">
                        <i class="fas fa-info-circle"></i> Los depósitos se procesan manualmente. Por favor, envíe exactamente la cantidad que desea depositar a la dirección proporcionada.
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Dirección TRX para depósito</label>
                        <div class="referral-code">
                            <span id="depositAddress">TRvzJ5gtskxSEH3kaQGbkVxsmo7afiu7Dm</span>
                            <button class="copy-btn" data-target="depositAddress">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <div class="form-text">Esta es su dirección personal para depósitos. No envíe otras criptomonedas a esta dirección.</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Monto a depositar (TRX)</label>
                        <input type="number" class="form-control" id="depositAmount" min="10" required>
                        <div class="form-text">El depósito mínimo es de 10 TRX.</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Hash de transacción (Opcional)</label>
                        <input type="text" class="form-control" id="transactionHash" placeholder="Ingrese el hash de su transacción para verificación más rápida">
                    </div>
                    
                    <button class="btn btn-primary w-100" id="submitDeposit">
                        <i class="fas fa-paper-plane"></i> Solicitar Depósito
                    </button>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">Historial de Depósitos</div>
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Monto</th>
                                    <th>Hash</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="depositsTable">
                                <tr>
                                    <td colspan="4" class="text-center">Cargando depósitos...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Página de Retiro -->
            <div id="withdraw-page" class="page d-none">
                <h1 class="mb-3">Solicitar Retiro</h1>
                
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">Información de Retiro</div>
                    </div>
                    
                    <div class="alert alert-warning">
                        <i class="fas fa-info-circle"></i> Los retiros se procesan dentro de las 24 horas. El monto mínimo de retiro es de 20 TRX.
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Saldo disponible</label>
                        <input type="text" class="form-control" id="availableBalance" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Dirección TRX para retiro</label>
                        <input type="text" class="form-control" id="withdrawAddress" placeholder="Ingrese su dirección TRX" required>
                        <div class="form-text">Asegúrese de que la dirección sea correcta. No nos hacemos responsables por fondos enviados a direcciones incorrectas.</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Monto a retirar (TRX)</label>
                        <input type="number" class="form-control" id="withdrawAmount" min="20" required>
                        <div class="form-text">El retiro mínimo es de 20 TRX.</div>
                    </div>
                    
                    <button class="btn btn-primary w-100" id="submitWithdraw">
                        <i class="fas fa-paper-plane"></i> Solicitar Retiro
                    </button>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">Historial de Retiros</div>
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Monto</th>
                                    <th>Dirección</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="withdrawalsTable">
                                <tr>
                                    <td colspan="4" class="text-center">Cargando retiros...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Página de Referidos -->
            <div id="referrals-page" class="page d-none">
                <h1 class="mb-3">Sistema de Referidos</h1>
                
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">Tu Código de Referido</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Comparte este código con tus amigos</label>
                        <div class="referral-code">
                            <span id="referralCode">CARGANDO...</span>
                            <button class="copy-btn" data-target="referralCode">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <div class="form-text">Gana un 10% de comisión por cada inversión que realicen tus referidos.</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tu enlace de referido</label>
                        <div class="referral-code">
                            <span id="referralLink">CARGANDO...</span>
                            <button class="copy-btn" data-target="referralLink">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">Tus Referidos</div>
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Usuario</th>
                                    <th>Fecha de Registro</th>
                                    <th>Inversión Total</th>
                                    <th>Tu Comisión</th>
                                </tr>
                            </thead>
                            <tbody id="referralsTable">
                                <tr>
                                    <td colspan="4" class="text-center">Cargando referidos...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">Ganancias por Referidos</div>
                    </div>
                    <div class="dashboard-cards">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Comisiones Totales</div>
                                <div class="card-icon primary">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                            </div>
                            <div class="card-value" id="totalCommissions">0 TRX</div>
                            <div class="card-description">Ganancias por referidos</div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Comisiones Disponibles</div>
                                <div class="card-icon secondary">
                                    <i class="fas fa-wallet"></i>
                                </div>
                            </div>
                            <div class="card-value" id="availableCommissions">0 TRX</div>
                            <div class="card-description">Listas para retirar</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Página de Historial -->
            <div id="history-page" class="page d-none">
                <h1 class="mb-3">Historial de Transacciones</h1>
                
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">Todas las Transacciones</div>
                        <div class="transaction-filters">
                            <button class="btn btn-primary btn-small" id="filterAll">Todas</button>
                            <button class="btn btn-outline btn-small" id="filterDeposits">Depósitos</button>
                            <button class="btn btn-outline btn-small" id="filterWithdrawals">Retiros</button>
                            <button class="btn btn-outline btn-small" id="filterInvestments">Inversiones</button>
                            <button class="btn btn-outline btn-small" id="filterEarnings">Ganancias</button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Descripción</th>
                                    <th>Monto</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsTable">
                                <tr>
                                    <td colspan="5" class="text-center">Cargando transacciones...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Página de Perfil -->
            <div id="profile-page" class="page d-none">
                <h1 class="mb-3">Mi Perfil</h1>
                
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">Información Personal</div>
                    </div>
                    
                    <form id="profileForm">
                        <div class="form-group">
                            <label class="form-label">Nombre de Usuario</label>
                            <input type="text" class="form-control" id="profileUsername" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="profileEmail" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Fecha de Registro</label>
                            <input type="text" class="form-control" id="profileRegistrationDate" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Código de Referido (Opcional)</label>
                            <input type="text" class="form-control" id="profileReferralCode" placeholder="Si te refirió alguien, ingresa su código aquí">
                        </div>
                    </form>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">Cambiar Contraseña</div>
                    </div>
                    
                    <form id="passwordForm">
                        <div class="form-group">
                            <label class="form-label">Contraseña Actual</label>
                            <input type="password" class="form-control" id="currentPassword" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Nueva Contraseña</label>
                            <input type="password" class="form-control" id="newPassword" minlength="6" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Confirmar Nueva Contraseña</label>
                            <input type="password" class="form-control" id="confirmPassword" minlength="6" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-key"></i> Cambiar Contraseña
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modales de Autenticación -->
    <div class="auth-container d-none" id="auth-container">
        <div class="auth-card">
            <!-- Modal de Registro -->
            <div id="register-modal" class="auth-modal">
                <div class="auth-header">
                    <div class="auth-title">Crear Cuenta</div>
                    <div class="auth-subtitle">Regístrate para comenzar a invertir</div>
                </div>
                
                <form id="registerForm">
                    <div class="form-group">
                        <label class="form-label">Nombre de Usuario</label>
                        <input type="text" class="form-control" id="registerUsername" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Correo Electrónico</label>
                        <input type="email" class="form-control" id="registerEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="registerPassword" minlength="6" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confirmar Contraseña</label>
                        <input type="password" class="form-control" id="registerConfirmPassword" minlength="6" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Código de Referido (Opcional)</label>
                        <input type="text" class="form-control" id="registerReferralCode" placeholder="Si te refirió alguien, ingresa su código aquí">
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">Registrarse</button>
                </form>
                
                <div class="auth-footer">
                    ¿Ya tienes una cuenta? <a href="#" class="auth-link" id="showLogin">Iniciar Sesión</a>
                </div>
            </div>
            
            <!-- Modal de Inicio de Sesión -->
            <div id="login-modal" class="auth-modal d-none">
                <div class="auth-header">
                    <div class="auth-title">Iniciar Sesión</div>
                    <div class="auth-subtitle">Accede a tu cuenta</div>
                </div>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label">Correo Electrónico</label>
                        <input type="email" class="form-control" id="loginEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="loginPassword" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">Iniciar Sesión</button>
                </form>
                
                <div class="auth-footer">
                    <div class="mb-3">
                        ¿Olvidaste tu contraseña? <a href="#" class="auth-link" id="showForgotPassword">Recuperar</a>
                    </div>
                    ¿No tienes una cuenta? <a href="#" class="auth-link" id="showRegister">Regístrate</a>
                </div>
            </div>
            
            <!-- Modal de Recuperación de Contraseña -->
            <div id="forgot-password-modal" class="auth-modal d-none">
                <div class="auth-header">
                    <div class="auth-title">Recuperar Contraseña</div>
                    <div class="auth-subtitle">Te enviaremos un enlace para restablecer tu contraseña</div>
                </div>
                
                <form id="forgotPasswordForm">
                    <div class="form-group">
                        <label class="form-label">Correo Electrónico</label>
                        <input type="email" class="form-control" id="forgotPasswordEmail" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">Enviar Enlace</button>
                </form>
                
                <div class="auth-footer">
                    <a href="#" class="auth-link" id="backToLogin">Volver al Inicio de Sesión</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalles de Inversión -->
    <div class="modal investment-detail-modal" id="investmentDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Detalles de Inversión</div>
                <button class="close-modal" id="closeInvestmentDetailModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="investmentDetailContent">
                <!-- Contenido dinámico de detalles de inversión -->
            </div>
        </div>
    </div>

    <!-- Diálogo de Confirmación Genérico -->
    <div class="modal confirmation-dialog" id="confirmationDialog">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="confirmationTitle">Confirmar Acción</div>
                <button class="close-modal" id="closeConfirmationDialog">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="text-center">
                <div class="confirmation-icon warning" id="confirmationIcon">
                    <i class="fas fa-exclamation"></i>
                </div>
                <h3 id="confirmationMessage">¿Estás seguro de que deseas realizar esta acción?</h3>
                <p id="confirmationDescription" class="text-muted">Esta acción no se puede deshacer.</p>
            </div>
            <div class="confirmation-actions">
                <button class="btn btn-outline" id="cancelAction">Cancelar</button>
                <button class="btn btn-primary" id="confirmAction">Confirmar</button>
            </div>
        </div>
    </div>

    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAi4QOp1WzDUMx2owRl-cPvF5EvWeD5x10",
            authDomain: "trx-hoy.firebaseapp.com",
            projectId: "trx-hoy",
            storageBucket: "trx-hoy.firebasestorage.app",
            messagingSenderId: "141306706252",
            appId: "1:141306706252:web:385728a8561c51254cf7e9",
            measurementId: "G-BFSFV46P9Q"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Variables globales
        let currentUser = null;
        let userData = null;
        let currentTransactionFilter = 'all';
        let pendingConfirmation = null;
        
        // Elementos del DOM
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const menuToggle = document.getElementById('menuToggle');
        const closeSidebar = document.getElementById('closeSidebar');
        const authContainer = document.getElementById('auth-container');
        const registerModal = document.getElementById('register-modal');
        const loginModal = document.getElementById('login-modal');
        const forgotPasswordModal = document.getElementById('forgot-password-modal');
        const showLogin = document.getElementById('showLogin');
        const showRegister = document.getElementById('showRegister');
        const showForgotPassword = document.getElementById('showForgotPassword');
        const backToLogin = document.getElementById('backToLogin');
        const registerForm = document.getElementById('registerForm');
        const loginForm = document.getElementById('loginForm');
        const forgotPasswordForm = document.getElementById('forgotPasswordForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.nav-links a, .sidebar-menu a[data-page]');
        const copyButtons = document.querySelectorAll('.copy-btn');
        const newInvestmentBtn = document.querySelector('.new-investment-btn');
        const investmentDetailModal = document.getElementById('investmentDetailModal');
        const closeInvestmentDetailModal = document.getElementById('closeInvestmentDetailModal');
        const investmentDetailContent = document.getElementById('investmentDetailContent');
        const confirmationDialog = document.getElementById('confirmationDialog');
        const closeConfirmationDialog = document.getElementById('closeConfirmationDialog');
        const cancelAction = document.getElementById('cancelAction');
        const confirmAction = document.getElementById('confirmAction');
        const confirmationTitle = document.getElementById('confirmationTitle');
        const confirmationMessage = document.getElementById('confirmationMessage');
        const confirmationDescription = document.getElementById('confirmationDescription');
        const confirmationIcon = document.getElementById('confirmationIcon');
        
        // Filtros de transacciones
        const filterAll = document.getElementById('filterAll');
        const filterDeposits = document.getElementById('filterDeposits');
        const filterWithdrawals = document.getElementById('filterWithdrawals');
        const filterInvestments = document.getElementById('filterInvestments');
        const filterEarnings = document.getElementById('filterEarnings');
        
        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
        
        // Función para inicializar la aplicación
        function initApp() {
            // Configurar event listeners
            setupEventListeners();
            
            // Verificar estado de autenticación
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    initializeUserData();
                    loadUserData();
                    showMainApp();
                } else {
                    showAuth();
                }
            });
        }
        
        // Función para inicializar datos del usuario
        function initializeUserData() {
            if (!currentUser) return;
            
            const userRef = db.collection('users').doc(currentUser.uid);
            
            userRef.get().then(doc => {
                if (!doc.exists) {
                    // Crear documento de usuario con todos los campos necesarios
                    userRef.set({
                        username: currentUser.displayName || currentUser.email.split('@')[0],
                        email: currentUser.email,
                        referralCode: generateReferralCode(),
                        referredBy: null,
                        balance: 0,
                        totalEarnings: 0,
                        totalInvested: 0,
                        activeInvestments: 0,
                        totalReferrals: 0,
                        totalCommissions: 0,
                        availableCommissions: 0,
                        registrationDate: new Date(),
                        lastLogin: new Date()
                    }).then(() => {
                        loadUserData();
                    });
                }
            }).catch(error => {
                console.error('Error al inicializar datos:', error);
            });
        }
        
        // Configurar event listeners
        function setupEventListeners() {
            // Menú lateral
            menuToggle.addEventListener('click', toggleSidebar);
            closeSidebar.addEventListener('click', toggleSidebar);
            overlay.addEventListener('click', toggleSidebar);
            
            // Navegación entre páginas
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    if (pageId) {
                        showPage(pageId);
                        if (window.innerWidth <= 768) {
                            toggleSidebar();
                        }
                    }
                });
            });
            
            // Botón de nueva inversión
            newInvestmentBtn.addEventListener('click', function(e) {
                e.preventDefault();
                showPage('invest');
            });
            
            // Botones de copiar
            copyButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const targetElement = document.getElementById(targetId);
                    copyToClipboard(targetElement.textContent);
                    showNotification('Copiado al portapapeles', 'success');
                });
            });
            
            // Autenticación
            showLogin.addEventListener('click', function(e) {
                e.preventDefault();
                showAuthModal('login');
            });
            
            showRegister.addEventListener('click', function(e) {
                e.preventDefault();
                showAuthModal('register');
            });
            
            showForgotPassword.addEventListener('click', function(e) {
                e.preventDefault();
                showAuthModal('forgot-password');
            });
            
            backToLogin.addEventListener('click', function(e) {
                e.preventDefault();
                showAuthModal('login');
            });
            
            registerForm.addEventListener('submit', handleRegister);
            loginForm.addEventListener('submit', handleLogin);
            forgotPasswordForm.addEventListener('submit', handleForgotPassword);
            logoutBtn.addEventListener('click', handleLogout);
            
            // Inversiones
            document.querySelectorAll('[data-plan]').forEach(button => {
                button.addEventListener('click', function() {
                    const plan = this.getAttribute('data-plan');
                    showInvestmentForm(plan);
                });
            });
            
            document.getElementById('investmentAmount').addEventListener('input', updateExpectedEarnings);
            document.getElementById('investForm').addEventListener('submit', handleInvestment);
            
            // Depósitos y retiros
            document.getElementById('submitDeposit').addEventListener('click', handleDeposit);
            document.getElementById('submitWithdraw').addEventListener('click', handleWithdraw);
            
            // Perfil
            document.getElementById('passwordForm').addEventListener('submit', handlePasswordChange);
            
            // Modal de detalles de inversión
            closeInvestmentDetailModal.addEventListener('click', function() {
                investmentDetailModal.classList.remove('active');
            });
            
            // Diálogo de confirmación
            closeConfirmationDialog.addEventListener('click', function() {
                confirmationDialog.classList.remove('active');
                if (pendingConfirmation && pendingConfirmation.reject) {
                    pendingConfirmation.reject();
                }
                pendingConfirmation = null;
            });
            
            cancelAction.addEventListener('click', function() {
                confirmationDialog.classList.remove('active');
                if (pendingConfirmation && pendingConfirmation.reject) {
                    pendingConfirmation.reject();
                }
                pendingConfirmation = null;
            });
            
            confirmAction.addEventListener('click', function() {
                confirmationDialog.classList.remove('active');
                if (pendingConfirmation && pendingConfirmation.resolve) {
                    pendingConfirmation.resolve();
                }
                pendingConfirmation = null;
            });
            
            // Filtros de transacciones
            filterAll.addEventListener('click', function() {
                setTransactionFilter('all');
            });
            
            filterDeposits.addEventListener('click', function() {
                setTransactionFilter('deposit');
            });
            
            filterWithdrawals.addEventListener('click', function() {
                setTransactionFilter('withdrawal');
            });
            
            filterInvestments.addEventListener('click', function() {
                setTransactionFilter('investment');
            });
            
            filterEarnings.addEventListener('click', function() {
                setTransactionFilter('earning');
            });
        }
        
        // Mostrar/ocultar menú lateral
        function toggleSidebar() {
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
        
        // Mostrar página específica
        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.add('d-none');
            });
            
            const targetPage = document.getElementById(`${pageId}-page`);
            if (targetPage) {
                targetPage.classList.remove('d-none');
                targetPage.classList.add('fade-in');
                
                // Cargar datos específicos de la página si es necesario
                if (pageId === 'dashboard') {
                    loadDashboardData();
                } else if (pageId === 'invest') {
                    resetInvestmentForm();
                } else if (pageId === 'deposit') {
                    loadDeposits();
                } else if (pageId === 'withdraw') {
                    loadWithdrawals();
                    updateAvailableBalance();
                } else if (pageId === 'referrals') {
                    loadReferralsData();
                } else if (pageId === 'history') {
                    loadTransactionHistory();
                } else if (pageId === 'profile') {
                    loadProfileData();
                }
            }
        }
        
        // Mostrar interfaz de autenticación
        function showAuth() {
            authContainer.classList.remove('d-none');
            document.querySelector('.main-content').classList.add('d-none');
            document.querySelector('header').classList.add('d-none');
            showAuthModal('register');
        }
        
        // Mostrar aplicación principal
        function showMainApp() {
            authContainer.classList.add('d-none');
            document.querySelector('.main-content').classList.remove('d-none');
            document.querySelector('header').classList.remove('d-none');
            showPage('dashboard');
        }
        
        // Mostrar modal de autenticación específico
        function showAuthModal(modal) {
            registerModal.classList.add('d-none');
            loginModal.classList.add('d-none');
            forgotPasswordModal.classList.add('d-none');
            
            if (modal === 'register') {
                registerModal.classList.remove('d-none');
            } else if (modal === 'login') {
                loginModal.classList.remove('d-none');
            } else if (modal === 'forgot-password') {
                forgotPasswordModal.classList.remove('d-none');
            }
        }
        
        // Sistema de notificaciones moderno
        function showNotification(message, type = 'info', title = null) {
            const notificationContainer = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let iconClass = 'fas fa-info-circle';
            if (type === 'success') iconClass = 'fas fa-check-circle';
            if (type === 'error') iconClass = 'fas fa-exclamation-circle';
            if (type === 'warning') iconClass = 'fas fa-exclamation-triangle';
            
            const notificationTitle = title || 
                (type === 'success' ? 'Éxito' : 
                 type === 'error' ? 'Error' : 
                 type === 'warning' ? 'Advertencia' : 'Información');
            
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="${iconClass}"></i>
                </div>
                <div class="notification-content">
                    <div class="notification-title">${notificationTitle}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            notificationContainer.appendChild(notification);
            
            // Animar entrada
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Configurar cierre
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.addEventListener('click', () => {
                notification.classList.remove('show');
                notification.classList.add('hide');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            });
            
            // Auto cerrar después de 5 segundos
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.classList.remove('show');
                    notification.classList.add('hide');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        // Sistema de diálogos de confirmación
        function showConfirmation(title, message, description = '', type = 'warning') {
            return new Promise((resolve, reject) => {
                confirmationTitle.textContent = title;
                confirmationMessage.textContent = message;
                confirmationDescription.textContent = description;
                
                // Configurar icono según el tipo
                confirmationIcon.className = 'confirmation-icon';
                let iconClass = 'fas fa-exclamation';
                
                if (type === 'danger') {
                    confirmationIcon.classList.add('danger');
                    iconClass = 'fas fa-exclamation-triangle';
                } else if (type === 'success') {
                    confirmationIcon.classList.add('success');
                    iconClass = 'fas fa-check';
                } else {
                    confirmationIcon.classList.add('warning');
                }
                
                confirmationIcon.innerHTML = `<i class="${iconClass}"></i>`;
                
                // Mostrar diálogo
                confirmationDialog.classList.add('active');
                
                // Guardar callbacks
                pendingConfirmation = { resolve, reject };
            });
        }
        
        // Manejar registro de usuario
        function handleRegister(e) {
            e.preventDefault();
            
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const referralCode = document.getElementById('registerReferralCode').value;
            
            if (password !== confirmPassword) {
                showNotification('Las contraseñas no coinciden', 'error');
                return;
            }
            
            // Crear usuario en Firebase Auth
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Generar código de referido único
                    const userReferralCode = generateReferralCode();
                    
                    // Crear documento de usuario en Firestore
                    return db.collection('users').doc(user.uid).set({
                        username: username,
                        email: email,
                        referralCode: userReferralCode,
                        referredBy: referralCode || null,
                        balance: 0,
                        totalEarnings: 0,
                        totalInvested: 0,
                        activeInvestments: 0,
                        totalReferrals: 0,
                        totalCommissions: 0,
                        availableCommissions: 0,
                        registrationDate: new Date(),
                        lastLogin: new Date()
                    });
                })
                .then(() => {
                    showNotification('Cuenta creada exitosamente', 'success');
                    showAuthModal('login');
                })
                .catch((error) => {
                    console.error('Error al registrar:', error);
                    showNotification('Error al crear la cuenta: ' + error.message, 'error');
                });
        }
        
        // Manejar inicio de sesión
        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Actualizar última fecha de inicio de sesión
                    return db.collection('users').doc(userCredential.user.uid).update({
                        lastLogin: new Date()
                    });
                })
                .catch((error) => {
                    console.error('Error al iniciar sesión:', error);
                    showNotification('Error al iniciar sesión: ' + error.message, 'error');
                });
        }
        
        // Manejar recuperación de contraseña
        function handleForgotPassword(e) {
            e.preventDefault();
            
            const email = document.getElementById('forgotPasswordEmail').value;
            
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    showNotification('Se ha enviado un enlace de recuperación a tu correo', 'success');
                    showAuthModal('login');
                })
                .catch((error) => {
                    console.error('Error al enviar correo de recuperación:', error);
                    showNotification('Error: ' + error.message, 'error');
                });
        }
        
        // Manejar cierre de sesión
        function handleLogout() {
            showConfirmation(
                'Cerrar Sesión', 
                '¿Estás seguro de que deseas cerrar sesión?',
                'Serás redirigido a la página de inicio de sesión.',
                'warning'
            ).then(() => {
                auth.signOut()
                    .then(() => {
                        currentUser = null;
                        userData = null;
                        showNotification('Sesión cerrada correctamente', 'info');
                    })
                    .catch((error) => {
                        console.error('Error al cerrar sesión:', error);
                        showNotification('Error al cerrar sesión', 'error');
                    });
            }).catch(() => {
                // Usuario canceló
            });
        }
        
        // Cargar datos del usuario
        function loadUserData() {
            if (!currentUser) return;
            
            db.collection('users').doc(currentUser.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        userData = doc.data();
                        updateUIWithUserData();
                    }
                })
                .catch(error => {
                    console.error('Error al cargar datos del usuario:', error);
                    showNotification('Error al cargar datos del usuario', 'error');
                    // Crear datos por defecto si no existen
                    initializeUserData();
                });
        }
        
        // Actualizar UI con datos del usuario
        function updateUIWithUserData() {
            if (!userData) return;
            
            // Actualizar información del usuario en el header
            document.getElementById('userName').textContent = userData.username;
            
            // Actualizar dashboard
            document.getElementById('totalBalance').textContent = (userData.balance || 0) + ' TRX';
            document.getElementById('totalEarnings').textContent = (userData.totalEarnings || 0) + ' TRX';
            document.getElementById('activeInvestments').textContent = userData.activeInvestments || 0;
            document.getElementById('totalReferrals').textContent = userData.totalReferrals || 0;
        }
        
        // Cargar datos del dashboard
        function loadDashboardData() {
            if (!currentUser) return;
            
            // Cargar inversiones activas
            db.collection('investments')
                .where('userId', '==', currentUser.uid)
                .where('status', '==', 'active')
                .get()
                .then(snapshot => {
                    const investmentsContainer = document.getElementById('activeInvestmentsContainer');
                    investmentsContainer.innerHTML = '';
                    
                    if (snapshot.empty) {
                        investmentsContainer.innerHTML = '<div class="text-center"><p>No tienes inversiones activas</p></div>';
                        return;
                    }
                    
                    // Actualizar contador de inversiones activas
                    document.getElementById('activeInvestments').textContent = snapshot.size;
                    
                    snapshot.forEach(doc => {
                        const investment = doc.data();
                        const investmentCard = createInvestmentCard(doc.id, investment);
                        investmentsContainer.appendChild(investmentCard);
                    });
                })
                .catch(error => {
                    console.error('Error al cargar inversiones:', error);
                    document.getElementById('activeInvestmentsContainer').innerHTML = '<div class="text-center"><p>Error al cargar inversiones</p></div>';
                });
        }
        
        // Crear tarjeta de inversión moderna
        function createInvestmentCard(id, investment) {
            const card = document.createElement('div');
            card.className = 'investment-card';
            
            // Calcular días transcurridos y restantes
            const startDate = investment.startDate.toDate();
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + 15);
            const today = new Date();
            const daysPassed = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            const daysRemaining = Math.max(0, 15 - daysPassed);
            const progressPercentage = Math.min(100, (daysPassed / 15) * 100);
            
            // Calcular ganancias acumuladas y disponibles
            const dailyEarnings = investment.amount * 0.03;
            const totalEarned = dailyEarnings * daysPassed;
            const availableEarnings = calculateAvailableEarnings(investment);
            
            card.innerHTML = `
                <div class="investment-header">
                    <div class="investment-title">Inversión #${id.substring(0, 8)}</div>
                    <span class="investment-plan">${investment.plan}</span>
                </div>
                
                <div class="investment-details">
                    <div class="investment-detail">
                        <div class="investment-detail-label">Monto Invertido</div>
                        <div class="investment-detail-value">${investment.amount} TRX</div>
                    </div>
                    <div class="investment-detail">
                        <div class="investment-detail-label">Ganancias Acumuladas</div>
                        <div class="investment-detail-value">${totalEarned.toFixed(2)} TRX</div>
                    </div>
                    <div class="investment-detail">
                        <div class="investment-detail-label">Ganancias Disponibles</div>
                        <div class="investment-detail-value">${availableEarnings.toFixed(2)} TRX</div>
                    </div>
                    <div class="investment-detail">
                        <div class="investment-detail-label">Días Restantes</div>
                        <div class="investment-detail-value">${daysRemaining}</div>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-info">
                        <span class="progress-label">Progreso de la inversión</span>
                        <span class="progress-percentage">${progressPercentage.toFixed(1)}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                    </div>
                </div>
                
                <div class="investment-actions">
                    <button class="btn btn-primary btn-small claim-earnings-btn" data-id="${id}">
                        <i class="fas fa-coins"></i> Reclamar Ganancias
                    </button>
                    <button class="btn btn-outline btn-small investment-details-btn" data-id="${id}">
                        <i class="fas fa-info-circle"></i> Detalles
                    </button>
                </div>
            `;
            
            // Agregar event listeners a los botones
            const claimBtn = card.querySelector('.claim-earnings-btn');
            claimBtn.addEventListener('click', function() {
                handleClaimEarnings(this.getAttribute('data-id'));
            });
            
            const detailsBtn = card.querySelector('.investment-details-btn');
            detailsBtn.addEventListener('click', function() {
                showInvestmentDetails(this.getAttribute('data-id'));
            });
            
            // Deshabilitar botón si no hay ganancias disponibles
            if (availableEarnings <= 0) {
                claimBtn.classList.add('btn-disabled');
                claimBtn.disabled = true;
            }
            
            return card;
        }
        
        // Mostrar detalles de inversión en modal
        function showInvestmentDetails(investmentId) {
            if (!currentUser) return;
            
            db.collection('investments').doc(investmentId).get()
                .then(doc => {
                    if (!doc.exists) {
                        showNotification('Inversión no encontrada', 'error');
                        return;
                    }
                    
                    const investment = doc.data();
                    
                    // Calcular información detallada
                    const startDate = investment.startDate.toDate();
                    const endDate = new Date(startDate);
                    endDate.setDate(endDate.getDate() + 15);
                    const today = new Date();
                    const daysPassed = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
                    const daysRemaining = Math.max(0, 15 - daysPassed);
                    const progressPercentage = Math.min(100, (daysPassed / 15) * 100);
                    
                    const dailyEarnings = investment.amount * 0.03;
                    const totalEarned = dailyEarnings * daysPassed;
                    const totalExpected = investment.amount * 1.45; // 45% de ganancia
                    
                    // Crear contenido del modal
                    investmentDetailContent.innerHTML = `
                        <div class="investment-info">
                            <div class="info-item">
                                <div class="info-label">ID de Inversión</div>
                                <div class="info-value">${investmentId.substring(0, 8)}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Plan</div>
                                <div class="info-value">${investment.plan}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Monto Invertido</div>
                                <div class="info-value">${investment.amount} TRX</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Fecha de Inicio</div>
                                <div class="info-value">${formatDateTime(startDate)}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Fecha de Finalización</div>
                                <div class="info-value">${formatDateTime(endDate)}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Días Transcurridos</div>
                                <div class="info-value">${daysPassed} de 15</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Días Restantes</div>
                                <div class="info-value">${daysRemaining}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Ganancias Diarias</div>
                                <div class="info-value">${dailyEarnings.toFixed(2)} TRX</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Ganancias Acumuladas</div>
                                <div class="info-value">${totalEarned.toFixed(2)} TRX</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Ganancias Totales Esperadas</div>
                                <div class="info-value">${totalExpected.toFixed(2)} TRX</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Retorno Total Esperado</div>
                                <div class="info-value">45%</div>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-info">
                                <span class="progress-label">Progreso de la inversión</span>
                                <span class="progress-percentage">${progressPercentage.toFixed(1)}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-3">
                            <p class="text-muted">Esta inversión generará ganancias diarias durante 15 días.</p>
                        </div>
                    `;
                    
                    // Mostrar modal
                    investmentDetailModal.classList.add('active');
                })
                .catch(error => {
                    console.error('Error al cargar detalles de inversión:', error);
                    showNotification('Error al cargar detalles de la inversión', 'error');
                });
        }
        
        // Calcular ganancias disponibles para reclamar
        function calculateAvailableEarnings(investment) {
            // En una implementación real, esto calcularía las ganancias disponibles
            // basándose en el último reclamo y el tiempo transcurrido
            const lastClaim = investment.lastClaim ? investment.lastClaim.toDate() : investment.startDate.toDate();
            const now = new Date();
            const hoursSinceLastClaim = (now - lastClaim) / (1000 * 60 * 60);
            
            // Permitir reclamar cada 24 horas
            if (hoursSinceLastClaim < 24) {
                return 0;
            }
            
            // Calcular ganancias desde el último reclamo
            const dailyEarnings = investment.amount * 0.03;
            const daysSinceLastClaim = hoursSinceLastClaim / 24;
            return dailyEarnings * Math.floor(daysSinceLastClaim);
        }
        
        // Manejar reclamo de ganancias
        function handleClaimEarnings(investmentId) {
            if (!currentUser || !userData) return;
            
            db.collection('investments').doc(investmentId).get()
                .then(doc => {
                    if (!doc.exists) {
                        showNotification('Inversión no encontrada', 'error');
                        return;
                    }
                    
                    const investment = doc.data();
                    const availableEarnings = calculateAvailableEarnings(investment);
                    
                    if (availableEarnings <= 0) {
                        showNotification('No hay ganancias disponibles para reclamar en este momento', 'warning');
                        return;
                    }
                    
                    // Mostrar confirmación
                    showConfirmation(
                        'Reclamar Ganancias',
                        `¿Estás seguro de que deseas reclamar ${availableEarnings.toFixed(2)} TRX?`,
                        'Las ganancias se agregarán a tu balance disponible.',
                        'success'
                    ).then(() => {
                        // Actualizar inversión con nuevo lastClaim
                        return db.collection('investments').doc(investmentId).update({
                            lastClaim: new Date(),
                            totalEarned: (investment.totalEarned || 0) + availableEarnings
                        });
                    })
                    .then(() => {
                        // Actualizar balance del usuario
                        const newBalance = (userData.balance || 0) + availableEarnings;
                        const newTotalEarnings = (userData.totalEarnings || 0) + availableEarnings;
                        
                        return db.collection('users').doc(currentUser.uid).update({
                            balance: newBalance,
                            totalEarnings: newTotalEarnings
                        });
                    })
                    .then(() => {
                        // Registrar transacción de ganancias
                        return db.collection('transactions').add({
                            userId: currentUser.uid,
                            type: 'earning',
                            amount: availableEarnings,
                            description: `Ganancias de inversión reclamadas`,
                            date: new Date(),
                            status: 'completed'
                        });
                    })
                    .then(() => {
                        showNotification(`Ganancias de ${availableEarnings.toFixed(2)} TRX reclamadas exitosamente`, 'success');
                        loadUserData();
                        loadDashboardData();
                    })
                    .catch(error => {
                        console.error('Error al reclamar ganancias:', error);
                        showNotification('Error al reclamar ganancias: ' + error.message, 'error');
                    });
                })
                .catch(error => {
                    console.error('Error al cargar inversión:', error);
                    showNotification('Error al cargar información de la inversión', 'error');
                });
        }
        
        // Mostrar formulario de inversión
        function showInvestmentForm(plan) {
            const investmentForm = document.getElementById('investmentForm');
            const selectedPlan = document.getElementById('selectedPlan');
            
            let planName = '';
            let minAmount = 0;
            let maxAmount = 0;
            
            switch(plan) {
                case 'basic':
                    planName = 'Plan Básico';
                    minAmount = 30;
                    maxAmount = 100;
                    break;
                case 'advanced':
                    planName = 'Plan Avanzado';
                    minAmount = 101;
                    maxAmount = 300;
                    break;
                case 'premium':
                    planName = 'Plan Premium';
                    minAmount = 301;
                    maxAmount = 500;
                    break;
            }
            
            selectedPlan.value = planName;
            document.getElementById('investmentAmount').setAttribute('min', minAmount);
            document.getElementById('investmentAmount').setAttribute('max', maxAmount);
            document.getElementById('investmentAmount').value = minAmount;
            
            updateExpectedEarnings();
            
            investmentForm.classList.remove('d-none');
            investmentForm.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Resetear formulario de inversión
        function resetInvestmentForm() {
            document.getElementById('investmentForm').classList.add('d-none');
            document.getElementById('investmentAmount').value = '';
            document.getElementById('expectedEarnings').value = '';
        }
        
        // Actualizar ganancias esperadas
        function updateExpectedEarnings() {
            const amount = parseFloat(document.getElementById('investmentAmount').value) || 0;
            const expectedEarnings = amount * 0.45; // 45% de retorno total
            document.getElementById('expectedEarnings').value = expectedEarnings.toFixed(2) + ' TRX';
        }
        
        // Manejar inversión
        function handleInvestment(e) {
            e.preventDefault();
            
            if (!currentUser || !userData) {
                showNotification('Debes iniciar sesión para invertir', 'error');
                return;
            }
            
            const amount = parseFloat(document.getElementById('investmentAmount').value);
            const plan = document.getElementById('selectedPlan').value;
            
            if (amount < 30 || amount > 500) {
                showNotification('El monto de inversión debe estar entre 30 y 500 TRX', 'error');
                return;
            }
            
            if (amount > userData.balance) {
                showNotification('Saldo insuficiente para realizar esta inversión', 'error');
                return;
            }
            
            // Mostrar confirmación
            showConfirmation(
                'Confirmar Inversión',
                `¿Estás seguro de que deseas invertir ${amount} TRX en el ${plan}?`,
                'El monto se descontará de tu balance y la inversión comenzará inmediatamente.',
                'warning'
            ).then(() => {
                // Crear inversión en Firestore
                return db.collection('investments').add({
                    userId: currentUser.uid,
                    amount: amount,
                    plan: plan,
                    startDate: new Date(),
                    endDate: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000), // 15 días
                    status: 'active',
                    earned: 0,
                    lastClaim: new Date()
                });
            })
            .then(() => {
                // Actualizar saldo del usuario y contador de inversiones activas
                const newBalance = userData.balance - amount;
                const newTotalInvested = (userData.totalInvested || 0) + amount;
                const newActiveInvestments = (userData.activeInvestments || 0) + 1;
                
                return db.collection('users').doc(currentUser.uid).update({
                    balance: newBalance,
                    totalInvested: newTotalInvested,
                    activeInvestments: newActiveInvestments
                });
            })
            .then(() => {
                // Registrar transacción de inversión
                return db.collection('transactions').add({
                    userId: currentUser.uid,
                    type: 'investment',
                    amount: amount,
                    description: `Inversión en ${plan}`,
                    date: new Date(),
                    status: 'completed'
                });
            })
            .then(() => {
                showNotification('Inversión realizada exitosamente', 'success');
                resetInvestmentForm();
                loadUserData();
                loadDashboardData();
            })
            .catch(error => {
                console.error('Error al realizar inversión:', error);
                showNotification('Error al realizar la inversión: ' + error.message, 'error');
            });
        }
        
        // Manejar depósito
        function handleDeposit() {
            if (!currentUser) return;
            
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const transactionHash = document.getElementById('transactionHash').value;
            
            if (amount < 10) {
                showNotification('El depósito mínimo es de 10 TRX', 'error');
                return;
            }
            
            // Mostrar confirmación
            showConfirmation(
                'Solicitar Depósito',
                `¿Estás seguro de que deseas solicitar un depósito de ${amount} TRX?`,
                'El depósito será procesado manualmente. Asegúrate de enviar el monto exacto a la dirección proporcionada.',
                'info'
            ).then(() => {
                // Crear solicitud de depósito
                return db.collection('deposits').add({
                    userId: currentUser.uid,
                    amount: amount,
                    transactionHash: transactionHash || '',
                    status: 'pending',
                    date: new Date()
                });
            })
            .then(() => {
                // Registrar transacción de depósito
                return db.collection('transactions').add({
                    userId: currentUser.uid,
                    type: 'deposit',
                    amount: amount,
                    description: `Depósito de ${amount} TRX`,
                    date: new Date(),
                    status: 'pending',
                    transactionHash: transactionHash || ''
                });
            })
            .then(() => {
                showNotification('Solicitud de depósito enviada. Será procesada manualmente.', 'success');
                document.getElementById('depositAmount').value = '';
                document.getElementById('transactionHash').value = '';
                loadDeposits();
            })
            .catch(error => {
                console.error('Error al solicitar depósito:', error);
                showNotification('Error al solicitar depósito: ' + error.message, 'error');
            });
        }
        
        // Cargar historial de depósitos (VERSIÓN CORREGIDA - SIN ÍNDICES COMPUESTOS)
        function loadDeposits() {
            if (!currentUser) return;
            
            const depositsTable = document.getElementById('depositsTable');
            if (!depositsTable) return;
            
            depositsTable.innerHTML = '<tr><td colspan="4" class="text-center">Cargando depósitos...</td></tr>';
            
            // Consulta simple sin ordenamiento para evitar índices compuestos
            db.collection('deposits')
                .where('userId', '==', currentUser.uid)
                .get()
                .then(snapshot => {
                    depositsTable.innerHTML = '';
                    
                    if (snapshot.empty) {
                        depositsTable.innerHTML = '<tr><td colspan="4" class="text-center">No hay depósitos registrados</td></tr>';
                        return;
                    }
                    
                    // Convertir a array y ordenar localmente
                    const deposits = [];
                    snapshot.forEach(doc => {
                        deposits.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    // Ordenar por fecha (más reciente primero)
                    deposits.sort((a, b) => {
                        const dateA = a.date ? a.date.toDate() : new Date(0);
                        const dateB = b.date ? b.date.toDate() : new Date(0);
                        return dateB - dateA;
                    });
                    
                    deposits.forEach(deposit => {
                        const row = document.createElement('tr');
                        
                        let statusClass = 'pending';
                        let statusText = 'Pendiente';
                        
                        if (deposit.status === 'completed') {
                            statusClass = 'completed';
                            statusText = 'Completado';
                        } else if (deposit.status === 'rejected') {
                            statusClass = 'cancelled';
                            statusText = 'Rechazado';
                        }
                        
                        // Manejar fechas de forma segura
                        let dateString = 'Fecha no disponible';
                        if (deposit.date && deposit.date.toDate) {
                            try {
                                dateString = formatDate(deposit.date.toDate());
                            } catch (e) {
                                dateString = 'Fecha inválida';
                            }
                        }
                        
                        row.innerHTML = `
                            <td>${dateString}</td>
                            <td>${deposit.amount || 0} TRX</td>
                            <td>${deposit.transactionHash || 'N/A'}</td>
                            <td><span class="status ${statusClass}">${statusText}</span></td>
                        `;
                        
                        depositsTable.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error al cargar depósitos:', error);
                    // Si hay error de índice, intentar con consulta más simple
                    if (error.message.includes('index')) {
                        depositsTable.innerHTML = '<tr><td colspan="4" class="text-center">Configurando base de datos. Intenta nuevamente en unos segundos.</td></tr>';
                        showNotification('La base de datos se está configurando. Por favor, intenta nuevamente en unos momentos.', 'warning');
                    } else {
                        depositsTable.innerHTML = '<tr><td colspan="4" class="text-center">Error al cargar depósitos: ' + error.message + '</td></tr>';
                    }
                });
        }
        
        // Actualizar saldo disponible para retiro
        function updateAvailableBalance() {
            if (!userData) return;
            
            document.getElementById('availableBalance').value = (userData.balance || 0) + ' TRX';
        }
        
        // Manejar retiro
        function handleWithdraw() {
            if (!currentUser || !userData) return;
            
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const address = document.getElementById('withdrawAddress').value;
            
            if (amount < 20) {
                showNotification('El retiro mínimo es de 20 TRX', 'error');
                return;
            }
            
            if (amount > userData.balance) {
                showNotification('Saldo insuficiente para realizar este retiro', 'error');
                return;
            }
            
            if (!address) {
                showNotification('Debes ingresar una dirección TRX válida', 'error');
                return;
            }
            
            // Mostrar confirmación
            showConfirmation(
                'Solicitar Retiro',
                `¿Estás seguro de que deseas solicitar un retiro de ${amount} TRX?`,
                `Los fondos se enviarán a la dirección: ${address.substring(0, 10)}...${address.substring(address.length - 10)}. El retiro será procesado dentro de 24 horas.`,
                'warning'
            ).then(() => {
                // Crear solicitud de retiro
                return db.collection('withdrawals').add({
                    userId: currentUser.uid,
                    amount: amount,
                    address: address,
                    status: 'pending',
                    date: new Date()
                });
            })
            .then(() => {
                // Registrar transacción de retiro
                return db.collection('transactions').add({
                    userId: currentUser.uid,
                    type: 'withdrawal',
                    amount: amount,
                    description: `Retiro a dirección ${address.substring(0, 10)}...`,
                    date: new Date(),
                    status: 'pending'
                });
            })
            .then(() => {
                // Actualizar saldo del usuario
                const newBalance = userData.balance - amount;
                return db.collection('users').doc(currentUser.uid).update({
                    balance: newBalance
                });
            })
            .then(() => {
                showNotification('Solicitud de retiro enviada. Será procesada dentro de 24 horas.', 'success');
                document.getElementById('withdrawAmount').value = '';
                document.getElementById('withdrawAddress').value = '';
                updateAvailableBalance();
                loadWithdrawals();
                loadUserData();
            })
            .catch(error => {
                console.error('Error al solicitar retiro:', error);
                showNotification('Error al solicitar retiro: ' + error.message, 'error');
            });
        }
        
        // Cargar historial de retiros (VERSIÓN CORREGIDA - SIN ÍNDICES COMPUESTOS)
        function loadWithdrawals() {
            if (!currentUser) return;
            
            const withdrawalsTable = document.getElementById('withdrawalsTable');
            if (!withdrawalsTable) return;
            
            withdrawalsTable.innerHTML = '<tr><td colspan="4" class="text-center">Cargando retiros...</td></tr>';
            
            // Consulta simple sin ordenamiento para evitar índices compuestos
            db.collection('withdrawals')
                .where('userId', '==', currentUser.uid)
                .get()
                .then(snapshot => {
                    withdrawalsTable.innerHTML = '';
                    
                    if (snapshot.empty) {
                        withdrawalsTable.innerHTML = '<tr><td colspan="4" class="text-center">No hay retiros registrados</td></tr>';
                        return;
                    }
                    
                    // Convertir a array y ordenar localmente
                    const withdrawals = [];
                    snapshot.forEach(doc => {
                        withdrawals.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    // Ordenar por fecha (más reciente primero)
                    withdrawals.sort((a, b) => {
                        const dateA = a.date ? a.date.toDate() : new Date(0);
                        const dateB = b.date ? b.date.toDate() : new Date(0);
                        return dateB - dateA;
                    });
                    
                    withdrawals.forEach(withdrawal => {
                        const row = document.createElement('tr');
                        
                        let statusClass = 'pending';
                        let statusText = 'Pendiente';
                        
                        if (withdrawal.status === 'completed') {
                            statusClass = 'completed';
                            statusText = 'Completado';
                        } else if (withdrawal.status === 'rejected') {
                            statusClass = 'cancelled';
                            statusText = 'Rechazado';
                        }
                        
                        // Manejar fechas de forma segura
                        let dateString = 'Fecha no disponible';
                        if (withdrawal.date && withdrawal.date.toDate) {
                            try {
                                dateString = formatDate(withdrawal.date.toDate());
                            } catch (e) {
                                dateString = 'Fecha inválida';
                            }
                        }
                        
                        // Acortar dirección para mostrar
                        const address = withdrawal.address || '';
                        const shortAddress = address.length > 20 ? 
                            address.substring(0, 10) + '...' + address.substring(address.length - 10) : 
                            address;
                        
                        row.innerHTML = `
                            <td>${dateString}</td>
                            <td>${withdrawal.amount || 0} TRX</td>
                            <td>${shortAddress || 'N/A'}</td>
                            <td><span class="status ${statusClass}">${statusText}</span></td>
                        `;
                        
                        withdrawalsTable.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error al cargar retiros:', error);
                    // Si hay error de índice, intentar con consulta más simple
                    if (error.message.includes('index')) {
                        withdrawalsTable.innerHTML = '<tr><td colspan="4" class="text-center">Configurando base de datos. Intenta nuevamente en unos segundos.</td></tr>';
                        showNotification('La base de datos se está configurando. Por favor, intenta nuevamente en unos momentos.', 'warning');
                    } else {
                        withdrawalsTable.innerHTML = '<tr><td colspan="4" class="text-center">Error al cargar retiros: ' + error.message + '</td></tr>';
                    }
                });
        }
        
        // Cargar datos de referidos
        function loadReferralsData() {
            if (!currentUser || !userData) return;
            
            // Actualizar código de referido
            document.getElementById('referralCode').textContent = userData.referralCode || 'N/A';
            document.getElementById('referralLink').textContent = window.location.origin + '?ref=' + (userData.referralCode || '');
            
            // Cargar lista de referidos
            db.collection('users')
                .where('referredBy', '==', userData.referralCode)
                .get()
                .then(snapshot => {
                    const referralsTable = document.getElementById('referralsTable');
                    referralsTable.innerHTML = '';
                    
                    if (snapshot.empty) {
                        referralsTable.innerHTML = '<tr><td colspan="4" class="text-center">No tienes referidos aún</td></tr>';
                        document.getElementById('totalReferrals').textContent = '0';
                        return;
                    }
                    
                    let totalCommissions = 0;
                    let availableCommissions = 0;
                    
                    snapshot.forEach(doc => {
                        const referredUser = doc.data();
                        const row = document.createElement('tr');
                        
                        // Calcular comisión (10% de la inversión total del referido)
                        const referralInvestment = referredUser.totalInvested || 0;
                        const commission = referralInvestment * 0.1;
                        
                        totalCommissions += commission;
                        availableCommissions += commission; // En un sistema real, esto sería más complejo
                        
                        row.innerHTML = `
                            <td>${referredUser.username}</td>
                            <td>${formatDate(referredUser.registrationDate.toDate())}</td>
                            <td>${referralInvestment} TRX</td>
                            <td>${commission.toFixed(2)} TRX</td>
                        `;
                        
                        referralsTable.appendChild(row);
                    });
                    
                    // Actualizar estadísticas de comisiones
                    document.getElementById('totalCommissions').textContent = totalCommissions.toFixed(2) + ' TRX';
                    document.getElementById('availableCommissions').textContent = availableCommissions.toFixed(2) + ' TRX';
                    document.getElementById('totalReferrals').textContent = snapshot.size;
                    
                    // Actualizar también en el dashboard
                    if (userData) {
                        userData.totalReferrals = snapshot.size;
                        updateUIWithUserData();
                    }
                })
                .catch(error => {
                    console.error('Error al cargar referidos:', error);
                    document.getElementById('referralsTable').innerHTML = '<tr><td colspan="4" class="text-center">Error al cargar referidos</td></tr>';
                });
        }
        
        // Cargar historial de transacciones (VERSIÓN CORREGIDA - SIN ÍNDICES COMPUESTOS)
        function loadTransactionHistory() {
            if (!currentUser) {
                console.log('Usuario no autenticado');
                return;
            }

            const transactionsTable = document.getElementById('transactionsTable');
            if (!transactionsTable) {
                console.log('Tabla de transacciones no encontrada');
                return;
            }
            
            transactionsTable.innerHTML = '<tr><td colspan="5" class="text-center">Cargando transacciones...</td></tr>';
            
            console.log('Cargando transacciones para usuario:', currentUser.uid);
            
            // Consulta simple sin ordenamiento para evitar índices compuestos
            let query = db.collection('transactions')
                .where('userId', '==', currentUser.uid)
                .limit(50); // Limitar para evitar cargas muy grandes

            query.get()
                .then(snapshot => {
                    console.log('Transacciones encontradas:', snapshot.size);
                    transactionsTable.innerHTML = '';
                    
                    if (snapshot.empty) {
                        transactionsTable.innerHTML = '<tr><td colspan="5" class="text-center">No hay transacciones registradas</td></tr>';
                        return;
                    }
                    
                    // Convertir a array y ordenar localmente
                    const transactions = [];
                    snapshot.forEach(doc => {
                        transactions.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    // Ordenar por fecha (más reciente primero)
                    transactions.sort((a, b) => {
                        const dateA = a.date ? a.date.toDate() : new Date(0);
                        const dateB = b.date ? b.date.toDate() : new Date(0);
                        return dateB - dateA;
                    });
                    
                    // Aplicar filtro si no es "all"
                    let filteredTransactions = transactions;
                    if (currentTransactionFilter !== 'all') {
                        filteredTransactions = transactions.filter(t => t.type === currentTransactionFilter);
                    }
                    
                    filteredTransactions.forEach(transaction => {
                        const row = document.createElement('tr');
                        
                        // Determinar clase CSS para el monto
                        let amountClass = '';
                        let amountPrefix = '';
                        
                        if (transaction.type === 'deposit' || transaction.type === 'earning') {
                            amountClass = 'transaction-positive';
                            amountPrefix = '+';
                        } else if (transaction.type === 'withdrawal' || transaction.type === 'investment') {
                            amountClass = 'transaction-negative';
                            amountPrefix = '-';
                        }
                        
                        // Determinar icono y clase para el tipo de transacción
                        let typeIcon = '';
                        let typeClass = '';
                        let typeText = '';
                        
                        switch(transaction.type) {
                            case 'deposit':
                                typeIcon = 'fas fa-wallet';
                                typeClass = 'transaction-type deposit';
                                typeText = 'Depósito';
                                break;
                            case 'withdrawal':
                                typeIcon = 'fas fa-money-bill-wave';
                                typeClass = 'transaction-type withdrawal';
                                typeText = 'Retiro';
                                break;
                            case 'investment':
                                typeIcon = 'fas fa-chart-line';
                                typeClass = 'transaction-type investment';
                                typeText = 'Inversión';
                                break;
                            case 'earning':
                                typeIcon = 'fas fa-coins';
                                typeClass = 'transaction-type earning';
                                typeText = 'Ganancia';
                                break;
                            default:
                                typeIcon = 'fas fa-exchange-alt';
                                typeClass = 'transaction-type';
                                typeText = transaction.type || 'Transacción';
                        }
                        
                        let statusClass = 'pending';
                        let statusText = 'Pendiente';
                        
                        if (transaction.status === 'completed') {
                            statusClass = 'completed';
                            statusText = 'Completado';
                        } else if (transaction.status === 'cancelled' || transaction.status === 'rejected') {
                            statusClass = 'cancelled';
                            statusText = 'Cancelado';
                        }
                        
                        // Asegurarse de que la fecha sea válida
                        let dateString = 'Fecha no disponible';
                        if (transaction.date && transaction.date.toDate) {
                            try {
                                dateString = formatDateTime(transaction.date.toDate());
                            } catch (e) {
                                console.error('Error formateando fecha:', e);
                                dateString = 'Fecha inválida';
                            }
                        }
                        
                        row.innerHTML = `
                            <td>${dateString}</td>
                            <td>
                                <span class="${typeClass}">
                                    <i class="${typeIcon}"></i>
                                    ${typeText}
                                </span>
                            </td>
                            <td>${transaction.description || 'Sin descripción'}</td>
                            <td class="${amountClass}">${amountPrefix}${transaction.amount || 0} TRX</td>
                            <td><span class="status ${statusClass}">${statusText}</span></td>
                        `;
                        
                        transactionsTable.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error al cargar transacciones:', error);
                    // Si hay error de índice, intentar con consulta más simple
                    if (error.message.includes('index')) {
                        transactionsTable.innerHTML = '<tr><td colspan="5" class="text-center">Configurando base de datos. Intenta nuevamente en unos segundos.</td></tr>';
                        showNotification('La base de datos se está configurando. Por favor, intenta nuevamente en unos momentos.', 'warning');
                    } else {
                        transactionsTable.innerHTML = '<tr><td colspan="5" class="text-center">Error al cargar transacciones: ' + error.message + '</td></tr>';
                    }
                });
        }
        
        // Establecer filtro de transacciones
        function setTransactionFilter(filter) {
            currentTransactionFilter = filter;
            
            // Actualizar estado activo de los botones
            document.querySelectorAll('#history-page .btn').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-outline');
            });
            
            const activeButton = document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`);
            if (activeButton) {
                activeButton.classList.remove('btn-outline');
                activeButton.classList.add('btn-primary');
            }
            
            // Recargar transacciones con el filtro aplicado
            loadTransactionHistory();
        }
        
        // Cargar datos del perfil
        function loadProfileData() {
            if (!userData) return;
            
            document.getElementById('profileUsername').value = userData.username || '';
            document.getElementById('profileEmail').value = userData.email || '';
            document.getElementById('profileRegistrationDate').value = userData.registrationDate ? 
                formatDate(userData.registrationDate.toDate()) : 'N/A';
            document.getElementById('profileReferralCode').value = userData.referredBy || '';
        }
        
        // Manejar cambio de contraseña
        function handlePasswordChange(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                showNotification('Las nuevas contraseñas no coinciden', 'error');
                return;
            }
            
            // Reautenticar al usuario
            const credential = firebase.auth.EmailAuthProvider.credential(
                currentUser.email, 
                currentPassword
            );
            
            currentUser.reauthenticateWithCredential(credential)
                .then(() => {
                    // Cambiar contraseña
                    return currentUser.updatePassword(newPassword);
                })
                .then(() => {
                    showNotification('Contraseña cambiada exitosamente', 'success');
                    document.getElementById('passwordForm').reset();
                })
                .catch(error => {
                    console.error('Error al cambiar contraseña:', error);
                    showNotification('Error al cambiar contraseña: ' + error.message, 'error');
                });
        }
        
        // Utilidades
        
        // Generar código de referido único
        function generateReferralCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        // Formatear fecha
        function formatDate(date) {
            return date.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }
        
        // Formatear fecha y hora
        function formatDateTime(date) {
            return date.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Copiar al portapapeles
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
    </script>
</body>
</html>
